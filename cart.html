<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø³Ù„Ø© - Zaytonaty</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html" class="logo">Zaytonaty ğŸ›’</a>
        <nav>
            <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="products.html">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
            <a href="cart.html">Ø§Ù„Ø³Ù„Ø© <span id="cart-count">0</span></a>
            <a href="admin.html">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
        </nav>
    </header>

    <div class="container">
        <h2>Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø³Ù„Ø©</h2>
        <table>
            <thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody id="cart-body"></tbody>
        </table>
        <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-price">0</span> Ø¬.Ù…</h3>

        <div style="max-width: 400px; background: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
            <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h2>
            <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <input type="tel" id="phone" placeholder="Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <button class="cta-btn" style="width:100%" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM",
            authDomain: "zaytonaty-f4240.firebaseapp.com",
            projectId: "zaytonaty-f4240",
            storageBucket: "zaytonaty-f4240.firebasestorage.app",
            messagingSenderId: "268778198002",
            appId: "1:268778198002:web:2803824e75be502f73916b"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.loadCart = function() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const body = document.getElementById('cart-body');
            let total = 0;
            body.innerHTML = cart.map((item, i) => {
                total += item.price;
                return `<tr><td>${item.name}</td><td>${item.price}</td><td><button class="del-btn" onclick="removeItem(${i})">Ø­Ø°Ù</button></td></tr>`;
            }).join('');
            document.getElementById('total-price').innerText = total;
            document.getElementById('cart-count').innerText = cart.length;
        }

        window.removeItem = (i) => {
            let cart = JSON.parse(localStorage.getItem('cart'));
            cart.splice(i, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        window.sendOrder = async () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const n = document.getElementById('name').value;
            const p = document.getElementById('phone').value;
            if(!n || !p || cart.length === 0) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            await addDoc(collection(db, "orders"), {
                customer_name: n, phone: p, address: document.getElementById('address').value,
                items: cart, total: document.getElementById('total-price').innerText, date: new Date().toLocaleString('ar-EG')
            });
            alert("ØªÙ… Ø§Ù„Ø·Ù„Ø¨!");
            localStorage.removeItem('cart');
            window.location.href = "index.html";
        }
        loadCart();
    </script>
</body>
</html>
