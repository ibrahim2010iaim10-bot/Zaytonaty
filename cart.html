<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <title>Cart - Zaytonaty</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html" class="logo">Zaytonaty ๐</a>
        <a href="tel:+201234567890" class="contact-info"><span>๐ 01018563500</span></a>
        <nav>
            <a href="products.html" data-tr="nav-back">ุงูุนูุฏุฉ ููุชุณูู</a>
            <button onclick="toggleLanguage()" class="lang-btn" id="lang-text">English</button>
        </nav>
    </header>

    <div class="container">
        <h2 data-tr="cart-title">ูุญุชููุงุช ุงูุณูุฉ</h2>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr><th data-tr="th-p">ุงูููุชุฌ</th><th data-tr="th-pr">ุงูุณุนุฑ</th><th data-tr="th-a">ุฅุฌุฑุงุก</th></tr>
                </thead>
                <tbody id="cart-body"></tbody>
            </table>
        </div>
        <h3 style="text-align:center; margin:20px 0;"><span data-tr="total-text">ุงูุฅุฌูุงูู:</span> <span id="total-price">0</span> ุฌ.ู</h3>

        <div class="shipping-form">
            <h3 data-tr="ship-h3">ุจูุงูุงุช ุงูุดุญู</h3>
            <input type="text" id="name" placeholder="ุงูุงุณู" data-p="p-name">
            <input type="tel" id="phone" placeholder="ุงูููุจุงูู" data-p="p-phone">
            <input type="text" id="address" placeholder="ุงูุนููุงู" data-p="p-address">
            <button class="cta-btn" style="width: 100%" onclick="sendOrder()" data-tr="btn-send">ุชุฃููุฏ ุงูุทูุจ</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM",
            authDomain: "zaytonaty-f4240.firebaseapp.com",
            projectId: "zaytonaty-f4240",
            appId: "1:268778198002:web:2803824e75be502f73916b"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const tr = {
            ar: { "nav-back": "ุงูุนูุฏุฉ ููุชุณูู", "cart-title": "ูุญุชููุงุช ุงูุณูุฉ", "th-p": "ุงูููุชุฌ", "th-pr": "ุงูุณุนุฑ", "th-a": "ุฅุฌุฑุงุก", "total-text": "ุงูุฅุฌูุงูู ุงููุณุชุญู:", "ship-h3": "๐ ุจูุงูุงุช ุงูุดุญู", "btn-send": "ุชุฃููุฏ ุงูุทูุจ", "p-name": "ุงูุงุณู", "p-phone": "ุงูููุจุงูู", "p-address": "ุงูุนููุงู" },
            en: { "nav-back": "Back to Shop", "cart-title": "Your Cart", "th-p": "Product", "th-pr": "Price", "th-a": "Action", "total-text": "Total:", "ship-h3": "๐ Shipping Details", "btn-send": "Confirm Order", "p-name": "Name", "p-phone": "Phone", "p-address": "Address" }
        };

        window.toggleLanguage = () => {
            const html = document.getElementById('main-html');
            const newLang = html.getAttribute('lang') === 'ar' ? 'en' : 'ar';
            html.setAttribute('lang', newLang); html.setAttribute('dir', newLang === 'ar' ? 'rtl' : 'ltr');
            document.getElementById('lang-text').innerText = newLang === 'ar' ? 'English' : 'ุงูุนุฑุจูุฉ';
            document.querySelectorAll('[data-tr]').forEach(el => el.innerText = tr[newLang][el.getAttribute('data-tr')]);
            document.querySelectorAll('[data-p]').forEach(el => el.placeholder = tr[newLang][el.getAttribute('data-p')]);
            localStorage.setItem('pref-lang', newLang); loadCart();
        };

        window.loadCart = () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const body = document.getElementById('cart-body');
            const lang = document.getElementById('main-html').getAttribute('lang');
            let total = 0;
            body.innerHTML = cart.map((item, i) => {
                total += item.price;
                return `<tr><td>${item.name}</td><td>${item.price}</td><td><button class="del-btn" onclick="removeItem(${i})">${lang==='ar'?'ุญุฐู':'Delete'}</button></td></tr>`;
            }).join('');
            document.getElementById('total-price').innerText = total;
        };

        window.removeItem = (i) => {
            let cart = JSON.parse(localStorage.getItem('cart'));
            cart.splice(i, 1); localStorage.setItem('cart', JSON.stringify(cart)); loadCart();
        };

        window.sendOrder = async () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const n = document.getElementById('name').value;
            const p = document.getElementById('phone').value;
            if(!n || !p || cart.length === 0) return alert("ุฎุทุฃ ูู ุงูุจูุงูุงุช");
            await addDoc(collection(db, "orders"), {
                customer_name: n, phone: p, address: document.getElementById('address').value,
                items: cart, total: document.getElementById('total-price').innerText, date: new Date().toLocaleString()
            });
            alert("ุชู ุฅุฑุณุงู ุทูุจู!"); localStorage.removeItem('cart'); window.location.href = "index.html";
        };

        window.onload = () => { if(localStorage.getItem('pref-lang') === 'en') toggleLanguage(); else loadCart(); };
    </script>
</body>
</html>
