<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ | Olivey</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #3d5a28; --secondary-color: #8ea604; --accent-color: #f4a261; --light-bg: #f9fdf5; --text-color: #333; --red-color: #dc3545;}
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background-color: var(--light-bg); color: var(--text-color); line-height: 1.6; min-height: 100vh; display: flex; flex-direction: column; }
        a { text-decoration: none; color: inherit; }
        header { background-color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 5%; max-width: 1200px; margin: 0 auto; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary-color); }
        .nav-links { list-style: none; display: flex; gap: 20px; }
        .nav-links a { font-weight: 500; transition: color 0.3s; padding: 5px 10px; border-radius: 5px; }
        .nav-links a:hover { color: white; background-color: var(--secondary-color); }
        .contact-info { font-size: 0.9rem; color: var(--primary-color); font-weight: bold; }

        .cart-container { max-width: 1200px; margin: 40px auto; padding: 20px; flex-grow: 1; display: flex; gap: 30px; flex-wrap: wrap; }
        .cart-container h2 { text-align: center; color: var(--primary-color); margin-bottom: 30px; font-size: 2.2rem; width: 100%; }
        
        /* Cart Items Section */
        .cart-items-section { flex: 2; min-width: 300px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .item-info { flex-grow: 1; }
        .item-name { font-weight: bold; color: var(--primary-color); }
        .item-price { color: #666; font-size: 0.9rem; }
        .item-controls { display: flex; align-items: center; gap: 15px; }
        .quantity-input { width: 50px; text-align: center; padding: 5px; border: 1px solid #ddd; border-radius: 5px; }
        .remove-btn { background: var(--red-color); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: background 0.3s; font-size: 0.9rem; }
        .remove-btn:hover { background: #c82333; }
        
        #empty-cart-message { text-align: center; padding: 50px; font-size: 1.1rem; color: #999; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* Summary and Checkout Section */
        .summary-section { flex: 1; min-width: 300px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); align-self: flex-start; }
        .summary-section h3 { color: var(--secondary-color); margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .total-row { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; color: var(--primary-color); }

        /* Checkout Form */
        #checkout-form label { display: block; margin-bottom: 5px; color: var(--primary-color); font-weight: bold; }
        #checkout-form input, #checkout-form textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .checkout-btn { background-color: var(--accent-color); color: var(--primary-color); padding: 12px 0; border: none; border-radius: 50px; cursor: pointer; font-size: 1.1rem; width: 100%; font-weight: bold; transition: background 0.3s; }
        .checkout-btn:hover { background-color: #e69557; }
        .clear-cart-btn { background: none; border: 1px solid var(--red-color); color: var(--red-color); padding: 10px; width: 100%; border-radius: 5px; margin-top: 10px; cursor: pointer; transition: all 0.3s; }
        .clear-cart-btn:hover { background: var(--red-color); color: white; }

        @media (max-width: 768px) {
            .cart-container { flex-direction: column; }
            .cart-items-section, .summary-section { width: 100%; }
        }

        /* Footer */
        footer { background-color: var(--primary-color); color: white; text-align: center; padding: 1.5rem; margin-top: auto; }
    </style>
</head>
<body>

    <header>
        <nav class="navbar">
            <div class="logo">Olivey ğŸŒ¿</div>
            <ul class="nav-links">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="products.html">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                <li><a href="cart.html">Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</a></li>
                <li><a href="admin_dashboard.html">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</a></li>
            </ul>
            <div class="contact-info">
                Ø§ØªØµÙ„ Ø¨Ù†Ø§: 201018563500+ ğŸ“
            </div>
        </nav>
    </header>

    <main class="cart-container">
        <h2>Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</h2>
        
        <div class="cart-items-section">
            <div id="cart-items-list">
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø© Ù‡Ù†Ø§ -->
                <p id="loading-message">...Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©</p>
                <div id="empty-cart-message" style="display: none;">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©. Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†! <a href="products.html" style="color: var(--secondary-color); font-weight: bold;">Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª</a></div>
            </div>
        </div>

        <div class="summary-section">
            <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
            
            <div class="total-row">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (ØºÙŠØ± Ø´Ø§Ù…Ù„ Ø§Ù„Ø´Ø­Ù†):</span>
                <span id="cart-total">0.00 Ø¬.Ù…</span>
            </div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ -->
            <form id="checkout-form">
                <h4>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h4>
                <label for="buyer-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                <input type="text" id="buyer-name" required placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ">

                <label for="buyer-phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                <input type="tel" id="buyer-phone" required placeholder="Ù…Ø«Ø§Ù„: 010xxxxxxxx">
                
                <label for="buyer-address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:</label>
                <textarea id="buyer-address" required placeholder="Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©"></textarea>

                <button type="submit" class="checkout-btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø¯ÙØ¹</button>
            </form>
            
            <button class="clear-cart-btn" onclick="clearCart()">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
        </div>
    </main>

    <footer>
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2023 Olivey</p>
    </footer>

    <!-- Firebase Initialization & Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
        
        // *************** Ù…ÙØ§ØªÙŠØ­ Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ***************
        const firebaseConfig = {
          apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM",
          authDomain: "zaytonaty-f4240.firebaseapp.com",
          projectId: "zaytonaty-f4240",
          storageBucket: "zaytonaty-f4240.firebasestorage.app",
          messagingSenderId: "268778198002",
          appId: "1:268778198002:web:2803824e75be502f73916b",
          measurementId: "G-Y47CN3QHJ1"
        };
        // *******************************************************

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const ordersCollection = collection(db, "orders");
        
        // *************** ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø© ***************

        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ù„Ø© Ù…Ù† LocalStorage
        function getCart() {
            return JSON.parse(localStorage.getItem('oliveyCart')) || [];
        }

        // Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© ÙÙŠ LocalStorage
        function saveCart(cart) {
            localStorage.setItem('oliveyCart', JSON.stringify(cart));
        }

        // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø³Ù„Ø©
        window.displayCart = function() {
            const cart = getCart();
            const listContainer = document.getElementById('cart-items-list');
            const totalElement = document.getElementById('cart-total');
            const checkoutForm = document.getElementById('checkout-form');
            const emptyMessage = document.getElementById('empty-cart-message');
            document.getElementById('loading-message').style.display = 'none';

            listContainer.innerHTML = '';
            
            if (cart.length === 0) {
                emptyMessage.style.display = 'block';
                checkoutForm.style.display = 'none';
                totalElement.textContent = '0.00 Ø¬.Ù…';
                return;
            }

            emptyMessage.style.display = 'none';
            checkoutForm.style.display = 'block';

            let total = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item';
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">${item.price.toFixed(2)} Ø¬.Ù… / ÙˆØ­Ø¯Ø©</div>
                    </div>
                    <div class="item-controls">
                        <input type="number" class="quantity-input" value="${item.quantity}" min="1" 
                               onchange="updateQuantity(${item.id}, this.value)">
                        <div>${itemTotal.toFixed(2)} Ø¬.Ù…</div>
                        <button class="remove-btn" onclick="removeItem(${item.id})">Ø¥Ø²Ø§Ù„Ø©</button>
                    </div>
                `;
                listContainer.appendChild(itemDiv);
            });

            totalElement.textContent = `${total.toFixed(2)} Ø¬.Ù…`;
        };

        // ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬
        window.updateQuantity = function(id, newQuantity) {
            let cart = getCart();
            const quantity = parseInt(newQuantity);
            
            if (quantity <= 0) {
                removeItem(id);
                return;
            }
            
            const itemIndex = cart.findIndex(item => item.id === id);
            if (itemIndex > -1) {
                cart[itemIndex].quantity = quantity;
                saveCart(cart);
                displayCart();
            }
        };

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
        window.removeItem = function(id) {
            let cart = getCart();
            cart = cart.filter(item => item.id !== id);
            saveCart(cart);
            displayCart();
        };
        
        // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        window.clearCart = function() {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø§ÙØ°Ø© Ù…ÙˆØ¯Ø§Ù„ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† confirm()
            if (window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙØ±Ø§Øº Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) {
                localStorage.removeItem('oliveyCart');
                displayCart();
            }
        };

        // *************** ÙˆØ¸ÙŠÙØ© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ (Checkout) ***************
        document.getElementById('checkout-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const cart = getCart();
            if (cart.length === 0) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø§ÙØ°Ø© Ù…ÙˆØ¯Ø§Ù„ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert()
                window.alert("Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ ÙØ§Ø±ØºØ©! Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.");
                return;
            }
            
            const name = document.getElementById('buyer-name').value;
            const phone = document.getElementById('buyer-phone').value;
            const address = document.getElementById('buyer-address').value;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);
            
            const orderData = {
                buyer: { name, phone, address },
                items: cart,
                total: parseFloat(total),
                date: new Date().toLocaleString('ar-EG'),
                status: 'Ø¬Ø¯ÙŠØ¯' // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø·Ù„Ø¨
            };

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Firebase
                const { addDoc } = await import("https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js");
                await addDoc(ordersCollection, orderData);
                
                // Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø·Ù„Ø¨
                localStorage.removeItem('oliveyCart');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø§ÙØ°Ø© Ù…ÙˆØ¯Ø§Ù„ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert()
                window.alert(`ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹. (ID ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø·Ù„Ø¨: ${orderData.date.substring(5, 12)})`);
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø© (Ù„ØªØ¸Ù‡Ø± ÙØ§Ø±ØºØ©)
                displayCart();

            } catch (error) {
                console.error("Error submitting order: ", error);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø§ÙØ°Ø© Ù…ÙˆØ¯Ø§Ù„ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert()
                window.alert("ÙØ´Ù„ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Firebase.");
            }
        });
        
        // ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = displayCart;

    </script>
</body>
</html>
