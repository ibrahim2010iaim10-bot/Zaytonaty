<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header><div class="logo">Zaytonaty ðŸ›’</div></header>

    <div style="padding: 40px 5%;">
        <h2>Ù…Ù†ØªØ¬Ø§ØªÙƒ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h2>
        <div id="cart-items"></div>
        <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-price">0</span> Ø¬.Ù…</h3>

        <div style="max-width: 400px; margin-top: 30px; background: white; padding: 20px; border-radius: 10px;">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
            <input type="text" id="name" placeholder="Ø§Ø³Ù…Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">
            <button class="btn" style="width: 100%" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ðŸš€</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM",
            authDomain: "zaytonaty-f4240.firebaseapp.com",
            projectId: "zaytonaty-f4240",
            storageBucket: "zaytonaty-f4240.firebasestorage.app",
            messagingSenderId: "268778198002",
            appId: "1:268778198002:web:2803824e75be502f73916b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('cart-items');
            let total = 0;
            container.innerHTML = cart.map(item => {
                total += item.price;
                return `<p>${item.name} - ${item.price} Ø¬.Ù…</p>`;
            }).join('');
            document.getElementById('total-price').innerText = total;
        }

        window.sendOrder = async () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const customer = {
                customer_name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                items: cart,
                total: document.getElementById('total-price').innerText,
                date: new Date().toLocaleString('ar-EG')
            };

            if(cart.length === 0 || !customer.phone) return alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

            try {
                await addDoc(collection(db, "orders"), customer);
                alert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!");
                localStorage.removeItem('cart');
                window.location.href = "index.html";
            } catch (e) { alert("Ø®Ø·Ø£!"); }
        };

        renderCart();
    </script>
</body>
</html>
