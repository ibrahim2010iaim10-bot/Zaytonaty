<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <title>Admin - Zaytonaty</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html" class="logo">Admin ðŸ”’</a>
        <a href="tel:+201234567890" class="contact-info"><span>ðŸ“ž 01234567890</span></a>
        <nav><button onclick="logout()" class="lang-btn" style="color:red; border-color:red;">Ø®Ø±ÙˆØ¬</button></nav>
    </header>

    <div id="login-ui" class="container" style="text-align:center; padding-top:50px;">
        <div style="background:white; padding:30px; border-radius:15px; max-width:400px; margin:auto; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
            <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
            <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="cta-btn" style="width:100%" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="admin-ui" class="container" style="display:none;">
        <h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <div class="table-wrapper">
            <table>
                <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                <tbody id="admin-body"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM",
            authDomain: "zaytonaty-f4240.firebaseapp.com",
            projectId: "zaytonaty-f4240",
            appId: "1:268778198002:web:2803824e75be502f73916b"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.login = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            signInWithEmailAndPassword(auth, e, p).catch(() => alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©"));
        };
        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, user => {
            if(user) {
                document.getElementById('login-ui').style.display='none';
                document.getElementById('admin-ui').style.display='block';
                onSnapshot(query(collection(db, "orders"), orderBy("date", "desc")), s => {
                    document.getElementById('admin-body').innerHTML = s.docs.map(d => {
                        const o = d.data();
                        return `<tr><td>${o.date}</td><td>${o.customer_name}</td><td>${o.phone}</td><td>${o.address}</td><td>${o.items.map(i=>i.name).join(', ')}</td><td>${o.total} Ø¬.Ù…</td></tr>`;
                    }).join('');
                });
            } else {
                document.getElementById('login-ui').style.display='block';
                document.getElementById('admin-ui').style.display='none';
            }
        });
    </script>
</body>
</html>
