<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>لوحة التحكم</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="auth-ui" style="text-align: center; padding-top: 100px;">
        <h2>دخول المسؤول</h2>
        <input type="email" id="email" placeholder="الإيميل" style="max-width:300px;"><br>
        <input type="password" id="pass" placeholder="الباسورد" style="max-width:300px;"><br>
        <button class="btn" onclick="login()">دخول</button>
    </div>

    <div id="admin-ui" style="display:none; padding: 20px;">
        <h2>قائمة الطلبات</h2>
        <table id="orders-table">
            <thead>
                <tr><th>التاريخ</th><th>العميل</th><th>الموبايل</th><th>العنوان</th><th>الطلبات</th><th>الحساب</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM",
            authDomain: "zaytonaty-f4240.firebaseapp.com",
            projectId: "zaytonaty-f4240",
            appId: "1:268778198002:web:2803824e75be502f73916b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.login = () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pass').value)
            .catch(() => alert("بيانات خاطئة"));
        };

        onAuthStateChanged(auth, user => {
            if(user) {
                document.getElementById('auth-ui').style.display='none';
                document.getElementById('admin-ui').style.display='block';
                const q = query(collection(db, "orders"), orderBy("date", "desc"));
                onSnapshot(q, s => {
                    const html = s.docs.map(d => {
                        const o = d.data();
                        return `<tr><td>${o.date}</td><td>${o.customer_name}</td><td>${o.phone}</td><td>${o.address}</td><td>${o.items.map(i=>i.name).join(',')}</td><td>${o.total}</td></tr>`;
                    }).join('');
                    document.querySelector('tbody').innerHTML = html;
                });
            }
        });
    </script>
</body>
</html>
