<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
    <!-- Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø«ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        :root { 
            --primary-color: #3d5a28; /* Ù„ÙˆÙ† Ø§Ù„Ø²ÙŠØªÙˆÙ† Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --secondary-color: #8ea604; /* Ù„ÙˆÙ† Ø§Ù„Ø²ÙŠØªÙˆÙ† Ø§Ù„ÙØ§ØªØ­ */
            --text-color: #1a1a1a;
            --status-new: #fcd34d;      /* Ø£ØµÙØ± - Ø¬Ø¯ÙŠØ¯ */
            --status-in-progress: #60a5fa; /* Ø£Ø²Ø±Ù‚ - Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° */
            --status-completed: #34d399; /* Ø£Ø®Ø¶Ø± - Ù…ÙƒØªÙ…Ù„ */
        }
        * { font-family: 'Tajawal', sans-serif; }
        .header-bg { background-color: var(--primary-color); }
        .status-badge { 
            padding: 4px 10px; 
            border-radius: 9999px; 
            font-weight: bold; 
            font-size: 0.75rem; 
            color: #1a1a1a; 
            display: inline-block;
        }
        .new { background-color: var(--status-new); }
        .in-progress { background-color: var(--status-in-progress); }
        .completed { background-color: var(--status-completed); }
        .action-btn { transition: background-color 0.2s, transform 0.1s; }
        .action-btn:hover { transform: translateY(-1px); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="header-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto py-4 px-4 flex justify-between items-center">
            <h1 class="text-3xl font-bold">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ğŸ› ï¸</h1>
            <a href="index.html" class="text-sm border border-white px-3 py-1 rounded-full hover:bg-white hover:text-green-800 transition">
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±
            </a>
        </div>
    </header>

    <!-- Main Content: Orders List -->
    <main class="flex-grow max-w-7xl mx-auto w-full p-6">
        <h2 class="text-2xl font-bold mb-6 text-gray-700 border-b pb-2">Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</h2>
        
        <!-- Messages Section (for success/error alerts) -->
        <div id="messages" class="mb-4 hidden p-3 rounded-lg text-center font-semibold"></div>

        <!-- Orders Table Container -->
        <div id="orders-container" class="bg-white shadow-2xl rounded-xl overflow-x-auto">
            <p id="loading-message" class="p-8 text-center text-gray-500">...Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
            <p id="empty-message" class="hidden p-8 text-center text-gray-500 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
            
            <table class="min-w-full divide-y divide-gray-200 hidden" id="orders-table">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="orders-table-body">
                    <!-- Orders will be injected here by JavaScript -->
                </tbody>
            </table>
        </div>
        
    </main>

    <!-- Footer Section -->
    <footer class="header-bg text-white text-center py-3 mt-8">
        <p>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Olivey Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
    </footer>

    <!-- Firebase SDKs and Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
        
        // *************** Firebase Configuration ***************
        // NOTE: These are mocked configurations.
        const firebaseConfig = {
          apiKey: "AIzaSyBJX4iidOGIO_WiS6g-LFw89rrJ6ReInoM", 
          authDomain: "zaytonaty-f4240.firebaseapp.com",
          projectId: "zaytonaty-f4240",
          storageBucket: "zaytonaty-f4240.firebasestorage.app",
          messagingSenderId: "268778198002",
          appId: "1:268778198002:web:2803824e75be502f73916b",
          measurementId: "G-Y47CN3QHJ1"
        };
        // *******************************************************

        const STATUSES = {
            'Ø¬Ø¯ÙŠØ¯': { class: 'new', label: 'Ø¬Ø¯ÙŠØ¯' },
            'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°': { class: 'in-progress', label: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' },
            'Ù…ÙƒØªÙ…Ù„': { class: 'completed', label: 'Ù…ÙƒØªÙ…Ù„' }
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        // Ù†Ø³ØªØ®Ø¯Ù… 'orders' ÙƒØ§Ø³Ù… Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        const ordersCollection = collection(db, "orders");
        
        // *************** ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø¨Ø¯ÙŠÙ„ Ø¹Ù† alert) ***************
        function showMessage(text, isError = false) {
            const msgEl = document.getElementById('messages');
            msgEl.textContent = text;
            msgEl.className = 'mb-4 p-3 rounded-lg text-center font-semibold';
            msgEl.style.display = 'block';
            if (isError) {
                msgEl.classList.add('bg-red-200', 'text-red-800');
            } else {
                msgEl.classList.add('bg-green-200', 'text-green-800');
            }
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                msgEl.style.display = 'none';
            }, 3000);
        }

        // *************** ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ***************

        // ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
        function setupRealtimeListener() {
            const tableBody = document.getElementById('orders-table-body');
            const ordersTable = document.getElementById('orders-table');
            const loadingMessage = document.getElementById('loading-message');
            const emptyMessage = document.getElementById('empty-message');
            
            // onSnapshot Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
            onSnapshot(query(ordersCollection), (snapshot) => {
                loadingMessage.style.display = 'none';
                tableBody.innerHTML = '';
                
                if (snapshot.empty) {
                    ordersTable.classList.add('hidden');
                    emptyMessage.style.display = 'block';
                    return;
                }
                
                ordersTable.classList.remove('hidden');
                emptyMessage.style.display = 'none';

                snapshot.forEach(orderDoc => {
                    const order = orderDoc.data();
                    const orderId = orderDoc.id;
                    // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                    const statusData = STATUSES[order.status] || STATUSES['Ø¬Ø¯ÙŠØ¯'];

                    // ØªØ¬Ù…ÙŠØ¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© HTML
                    const itemsList = order.items.map(item => 
                        `<li>${item.name} (Ã—${item.quantity}) - ${item.price.toFixed(2)} Ø¬.Ù…</li>`
                    ).join('');

                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${orderId.substring(0, 8)}...</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <span class="font-bold">${order.buyer.name}</span><br>
                            <span class="text-xs text-gray-600">${order.buyer.phone}</span>
                            <div class="mt-1 font-bold text-gray-800">${order.total.toFixed(2)} Ø¬.Ù…</div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs">
                            <ul class="list-disc list-inside text-xs">${itemsList}</ul>
                            <div class="mt-2 text-xs text-gray-600 font-bold border-t pt-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${order.buyer.address}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="status-badge ${statusData.class}" id="status-${orderId}">${statusData.label}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <select id="status-select-${orderId}" class="p-2 border rounded-md text-sm mb-2 w-full">
                                <option value="Ø¬Ø¯ÙŠØ¯" ${order.status === 'Ø¬Ø¯ÙŠØ¯' ? 'selected' : ''}>Ø¬Ø¯ÙŠØ¯</option>
                                <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                                <option value="Ù…ÙƒØªÙ…Ù„" ${order.status === 'Ù…ÙƒØªÙ…Ù„' ? 'selected' : ''}>Ù…ÙƒØªÙ…Ù„</option>
                            </select>
                            <button onclick="updateOrderStatus('${orderId}')" class="action-btn bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-md text-xs font-semibold w-full">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</
